/*! GradientFinder - v0.1.1 - 2012-06-05
 */
(function(a){function b(a,b){return b=b||0,Math.round(a*Math.pow(10,b))/Math.pow(10,b)}function d(a,b,c){this.stops=a,this.angle=b}function e(a,b,d){return d===undefined?new c(a[b]):new c(a[d][b])}function f(a,b,d){return a.length===1?new c(a[0]):(b=b||0,d=(d||a.length)-b,a=a.slice(b),d%2===0?e(a,d/2):c.getAvg(e(a,Math.floor(d/2)),e(a,Math.ceil(d/2))))}function g(a,b){function c(a){function b(a){return a*Math.PI/180}return{x:Math.max(Math.cos(b(a)),0),y:Math.max(Math.sin(b(a)),0)}}a=a%360;var d=c(180-a),e=c(0-a);return{x1:d.x*b,y1:d.y*b,x2:e.x*b,y2:e.y*b}}function h(a){var b=[],c;for(var d=0;d<a.length;d++)a[d]!==c&&(b.push(a[d]),c=a[d]);return b}function i(a){function b(a){var b=[];for(var c=0;c<=180;c++){var d=j(a,c).map(function(a){return a.join()});if(d[0]===d[d.length-1])b.push(c);else{var e=h(d),f=e[0];for(var g=1;g<e.length;g++){if(!q(f,e[g]))break;g===e.length-1&&b.push(c)}}}return b}function c(a,b){var c=b.map(function(b){var c=j(a,b);return{angle:b,stops:l(c)}});return c=c.sort(function(a,b){return a.stops.length===b.stops.length?a.angle-b.angle:a.stops.length===1?1:b.stops.length===1?-1:a.stops.length-b.stops.length}),c[0].angle}var d=b(a).map(function(a){return a-90}),e=c(a,d);if(typeof e=="undefined")throw"Couldn't find a gradient angle";return e}function j(a,c){var d=a[0].length,e=a.length,f=Math.sqrt(Math.pow(d,2)+Math.pow(e,2)),h=g(c,f),i=k(b(h.x1),b(h.y1),b(h.x2),b(h.y2)),j=[];for(var l=0;l<i.length;l++){var m=i[l][0],n=i[l][1];typeof a[n]!="undefined"&&typeof a[n][m]!="undefined"&&j.push(a[n][m])}return j}function k(a,b,c,d){if(isNaN(a)||isNaN(b)||isNaN(c)||isNaN(d))throw"Invalid coordinates for Bresenham's";a=Math.round(a),b=Math.round(b),c=Math.round(c),d=Math.round(d);var e=[],f=Math.abs(c-a),g=Math.abs(d-b),h=a<c?1:-1,i=b<d?1:-1,j=f-g;e.push([a,b]);while(a!==c||b!==d){var k=j*2;k>-g&&(j-=g,a+=h),k<f&&(j+=f,b+=i),e.push([a,b])}return e}function l(a,b,d){var g=[];b=b||0,d=d||a.length-1;var h=e(a,b),i=e(a,d),j=c.getAvg(h,i),k=f(a,b,d);return j.equals(k)?(g.push(b),d!==a.length-1?g=g.concat(l(a,d,a.length-1)):d===a.length-1&&!h.equals(i)&&g.push(d)):g=g.concat(l(a,b,d-1)),g}function m(a){var c=i(a),f=j(a,c),g=l(f),h=g.map(function(a){var c=b(a/(f.length-1),2);return{idx:c,color:e(f,a)}});return new d(h,c)}function n(a){var b=a.getImageData(0,0,a.canvas.width,a.canvas.height),c=b.width,d=b.height,e=b.data,f=[];for(var g=0;g<d;g++){var h=[];for(var i=0;i<c;i++){var j=(c*g+i)*4,k=e[j],l=e[j+1],m=e[j+2],n=e[j+3];h.push([k,l,m,n])}f[g]=h}return f}function o(a){var b=a.getContext("2d"),c=n(b),d=m(c);return d}function p(a,b){var c=new Image;c.src=a,c.onload=function(){var a=this,c=document.createElement("canvas"),d=c.getContext("2d");c.width=a.width,c.height=a.height,d.drawImage(a,0,0),b(o(c))}}function q(a,b){var d=a,e=b;return a.length&&(d=new c(a)),b.length&&(e=new c(b)),c.prototype.equals.apply(d,[e])}var c=function(a){typeof a=="string"&&(a=a.split(",")),this.r=a[0],this.g=a[1],this.b=a[2],a.length===4&&(this.a=b(a[3]/255,2));if(typeof this.r=="undefined"||typeof this.g=="undefined"||typeof this.b=="undefined")throw"Invalid Color Array passed in"};c.getAvg=function(a,b){var d=[(a.r+b.r)/2,(a.g+b.g)/2,(a.b+b.b)/2];if(typeof a.a!="undefined"||typeof (b.a!=="undefined"))a.a=typeof a.a=="undefined"?255:a.a,b.a=typeof b.a=="undefined"?255:b.a,d.push((a.a+b.a)/2);return new c(d)},c.prototype.equals=function(a,b){b=typeof b=="undefined"?4:b;if(Math.abs(this.r-a.r)>b)return!1;if(Math.abs(this.g-a.g)>b)return!1;if(Math.abs(this.b-a.b)>b)return!1;var c=typeof this.a=="undefined"?1:this.a,d=typeof a.a=="undefined"?1:a.a,e=b/25;return Math.abs(c-d)>b?!1:!0},c.prototype.distanceFrom=function(a){return Math.sqrt(3*Math.pow(this.r-a.r,2)+4*Math.pow(this.g-a.g,2)+2*Math.pow(this.b-a.b,2)+Math.pow(this.a-a.a,2))},c.prototype.toString=function(){return this.a===1?"rgb("+b(this.r)+", "+b(this.g)+", "+b(this.b)+")":"rgba("+b(this.r)+", "+b(this.g)+", "+b(this.b)+", "+b(this.a,2)+")"},d.prototype.toCss=function(){if(this.stops.length===1)return"background-color: "+this.stops[0].color.toString();var a=this.stops.map(function(a){return a.color.toString()+" "+b(a.idx*100)+"%"}),c=this.angle+"deg, "+a.join(",");return"background: -webkit-linear-gradient("+c+");\n"+"background: -o-linear-gradient("+c+");\n"+"background: -ms-linear-gradient("+c+");\n"+"background: -moz-linear-gradient("+c+");\n"+"background: linear-gradient("+c+");\n"},a.GradientCalc={findGrad:p,findGradFromCanvas:o,colorsEqual:q}})(window);