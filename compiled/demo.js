/*GradientFinder - Copyright (c) 2012 Aaron Marasco https://github.com/aaronm67/gradientfinder/raw/master/LICENSE
 */
var App={};App.onStateChange=function(a){Generator.gradientPicker.gradient=Gradient.fromExportable(a),Generator.hardReload()},App.getState=function(){return Generator.gradientPicker.gradient.toExportable()},App.undo=function(){return UndoManager.undo(),!1},App.redo=function(){return UndoManager.redo(),!1},App.setGuides=function(a,b){$(".guide").remove();var c=[];for(var d=0;d<a.length;d++)c.push(String.sprintf("<div class='guide guide-x' style='left: %dpx; '></div>",a[d]));for(var d=0;d<b.length;d++)c.push(String.sprintf("<div class='guide guide-y' style='top: %dpx; '></div>",b[d]));$("#guides").html(c.join(""))},App.getGridGuides=function(){var a=60,b=20,c=20,d=[0];for(var e=0;e<c;e++)d.push(e*(b+a)+a);return d};var Clipboard={_item:null,_cb:null,copy:function(a,b){Clipboard._item=a,Clipboard._cb=b},clear:function(){Clipboard._item=null,Clipboard._cb=null},paste:function(){if(Clipboard._item){var a=Clipboard._cb(Clipboard._item);return a===!1?!1:!0}return!1}},Generator={gradientPicker:null,loadFromExportable:function(a){return Generator.gradientPicker.loadFromExportable(a)},onPaste:function(a){Generator.gradientPicker.cloneStop(a)},keys:function(){key("command+z",function(a){App.undo(),a.preventDefault()}),key("command+shift+z",function(a){App.redo(),a.preventDefault()}),key("delete, backspace",function(a){var b=Generator.gradientPicker.removeCurrentStop();b&&a.preventDefault()}),key("⌘+c, ctrl+c",function(a){var b=Generator.getActive().data("stop");b&&Clipboard.copy(b,Generator.onPaste)}),key("⌘+v, ctrl+v",function(a){if(!$(a.target).is("input")){var b=Clipboard.paste();b&&a.preventDefault()}}),key("shift+left, left",function(a){Generator.nudgeActive(a.shiftKey?-5:-1)&&a.preventDefault()}),key("shift+right, right",function(a){Generator.nudgeActive(a.shiftKey?5:1)&&a.preventDefault()})},getActive:function(){return Generator.gradientPicker.getActive()},setActive:function(a){$("#copy").toggleClass("disabled",!a.length),Generator.gradientPicker.setActive(a)},nudgeActive:function(a){var b=Generator.getActive().data("stop");if(b)return b.setOffset(b.offset+a/100),Generator.softReload(),!0},init:function(){Generator.gradientPicker=new FreeStyle.GradientPicker($("#gradient-picker")),Generator.gradientPicker.addEventListener(FreeStyle.GradientPicker.Events.StateChange,function(){UndoManager.addState()}),Generator.keys(),$("#undo").click(App.undo),$("#redo").click(App.redo),$(document).click(function(a){$(a.target).closest(".stop").length===0&&Generator.setActive($([]))}),$("#copy").click(function(){if($(this).hasClass("disabled"))return;var a=Generator.getActive().data("stop");return a&&Clipboard.copy(a,Generator.onPaste),!1}),$("#paste").click(function(){if($(this).hasClass("disabled"))return;return Clipboard.paste(),!1})},softReload:function(){var a=Generator.gradientPicker.gradient,b=a.toCSS(),c=a.toCSSColor("left"),d=a.toCSSAlpha("left"),e=["#trackbottom { background: "+c+"; }","#tracktop .top-filler { background: "+d+"; }"];Generator.applyToBody&&e.push("body { background: "+b+" } ");var f=PrefixFree.prefixCSS(e.join("")),g="background: -webkit-"+b+";\n"+"background: -o-"+b+";\n"+"background: -ms-"+b+";\n"+"background: -moz-"+b+";\n"+"background: "+b+";\n";$("#grad").val(g),$("#filedropper").attr("style",g),$("#custom-style").html(f),$("#anglepicker").anglepicker("value",Generator.gradientPicker.getAngle()),$("#current-angle").val(Generator.gradientPicker.getAngle());var h=$("#track").width(),i=1;$(".stop").each(function(){var a=Math.round($(this).data("stop").getOffset()*h-$(this).outerWidth(!0)/2);$(this).css({left:a+"px"});var b=$(this).find(".ui-slider-handle");b.length&&b.attr("stop-tabindex",i++),$(this).attr("stop-tabindex",i++);var c=$(this).data("stop").offset||0;$(this).find(".label-offset").text(Math.round(c*100)+"%")})},hardReload:function(){Generator.gradientPicker.hardReload()}};window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))},$(function(){GradientFinderDemo.init(),loadSamples(),Generator.init(),GradientFinder.fromUrl("gradients/purdy.png",function(a){Generator.loadFromExportable(a.toExportable()),Generator.hardReload()})}),GradientFinder.Color.prototype.toExportable=function(){return{r:this.r,g:this.g,b:this.b,a:Math.round(this.a/255*100)/100}},GradientFinder.Gradient.prototype.toExportable=function(){return{colors:this.stops.map(function(a){return[a.idx,a.color.toExportable()]}),alphas:[],angle:this.angle}};var GradientFinderDemo={init:function(){var a={readAsMap:{".*":"DataURL"},dragClass:"filedrop",on:{error:function(){alert("You must run this on a webserver to get results")},load:function(a,b){var c=a.target.result;GradientFinder.fromUrl(c,function(a){if(a){var b=a.toCss();$("#grad").height(150),$("#uploaded-image").attr("src",c),$("#uploaded-image-container").show(),$("#error").hide(),Generator.loadFromExportable(a.toExportable()),Generator.hardReload()}else $("#error").show(),$("#uploaded-image-container").hide()})}}};$("body").fileReaderJS(a).fileClipboard(a),$("#applyBody").click(function(){$(this).is(":checked")?GradientFinderDemo.applyToBody():GradientFinderDemo.removeFromBody()})},applyToBody:function(){Generator.applyToBody=!0,Generator.softReload()},removeFromBody:function(){Generator.applyToBody=!1,Generator.softReload()}},first=!0,loadSamples=function(){$("#showExamples").click(function(a){a.preventDefault();if(first){for(var b=0;b<=90;b+=5)$("#samples").append("<tr><td><img data-src='gradients/generic/"+b+".png' />"+"<td>"+"<div class='preview'></div>"+"</td>"+"<td>"+"<textarea class='css'></textarea>"+"</td>");$("#samples img").load(function(a){var b=this,c=document.createElement("canvas"),d=c.getContext("2d");c.width=b.width,c.height=b.height,d.drawImage(b,0,0);var e=GradientFinder.fromCanvas(c);if(e){var f=$(b).parent().siblings().find(".preview"),g=$(b).parent().siblings().find(".css");f.attr("style",e.toCss()),g.val(e.toCss())}}),$("#samples img").attr("src",function(){return $(this).data("src")})}first=!1,$("#example-container").is(":visible")?($("#example-container").hide(),$(this).text("View")):($("#example-container").show(),$(this).text("Hide"))})};