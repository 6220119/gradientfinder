/*GradientFinder - Copyright (c) 2012 Aaron Marasco https://github.com/aaronm67/gradientfinder/raw/master/LICENSE
    FileReader.js - Copyright 2012 Brian Grinstead - MIT License. http://github.com/bgrins/filereader.js */
(function(a){function b(a,b){return b=b||0,Math.round(a*Math.pow(10,b))/Math.pow(10,b)}function c(a,b){var c={},d=[];for(var e=0,f=a.length;e<f;++e){var g=b?b(a[e]):a[e];c.hasOwnProperty(g)||(d.push(a[e]),c[g]=1)}return d}function d(a){var b=[];for(var c=0,e=a.length;c<e;c++)b=b.concat(a[c].length?d(a[c]):a[c]);return b}function e(a,b){for(var c=0;c<a.length;c++)b[c]=a[c]}function g(a,b,c){this.stops=a,this.angle=b,this.colorarray=c}function h(a,b,c){return c===undefined?new f(a[b]):new f(a[c][b])}function i(a,b,c){return a.length===1?new f(a[0]):(b=b||0,c=(c||a.length)-b,a=a.slice(b),c%2===0?h(a,c/2):f.getAvg(h(a,Math.floor(c/2)),h(a,Math.ceil(c/2))))}function j(a,b){function c(a){function b(a){return a*Math.PI/180}return{x:Math.max(Math.cos(b(a)),0),y:Math.max(Math.sin(b(a)),0)}}a=a%360;var d=c(180-a),e=c(0-a);return{x1:d.x*b,y1:d.y*b,x2:e.x*b,y2:e.y*b}}function k(a){var b=[],c;for(var d=0;d<a.length;d++)a[d]!==c&&(b.push(a[d]),c=a[d]);return b}function l(a){function b(a){var b=[];for(var c=0;c<=180;c++){var d=m(a,c).map(function(a){return a.join()});if(d[0]===d[d.length-1])b.push(c);else{var e=k(d),f=e[0];for(var g=1;g<e.length;g++){if(!u(f,e[g]))break;g===e.length-1&&b.push(c)}}}return b}function c(a,b){var c=b.map(function(b){var c=m(a,b);return{angle:b,stops:p(c)}});c=c.sort(function(a,b){return a.stops.length===b.stops.length?a.angle===90||a.angle===0||a.angle===-90?-1:b.angle===90||b.angle===0||b.angle===-90?1:a.angle-b.angle:a.stops.length===1?1:b.stops.length===1?-1:a.angle-b.angle});if(c.length===0)throw"Couldn't find gradient angle";return c[0].angle}var d=b(a).map(function(a){return a-90}),e=c(a,d);return e}function m(a,c){var d=a[0].length,e=a.length,f=Math.sqrt(Math.pow(d,2)+Math.pow(e,2)),g=j(c,f),h=n(b(g.x1),b(g.y1),b(g.x2),b(g.y2)),i=[];for(var k=0;k<h.length;k++){var l=h[k][0],m=h[k][1];typeof a[m]!="undefined"&&typeof a[m][l]!="undefined"&&i.push(a[m][l])}return i}function n(a,b,c,d){a=parseFloat(a),b=parseFloat(b),c=parseFloat(c),d=parseFloat(d);if(isNaN(a)||isNaN(b)||isNaN(c)||isNaN(d))throw"Invalid coordinates for Bresenham's";a=Math.round(a),b=Math.round(b),c=Math.round(c),d=Math.round(d);var e=[],f=Math.abs(c-a),g=Math.abs(d-b),h=a<c?1:-1,i=b<d?1:-1,j=f-g;e.push([a,b]);while(a!==c||b!==d){var k=j*2;k>-g&&(j-=g,a+=h),k<f&&(j+=f,b+=i),e.push([a,b])}return e}function o(a,c,d){var e=h(a,c),g=b(a.length/5);for(var j=d;j>c;j-=g){var k=h(a,j),l=f.getAvg(e,k),m=i(a,c,d);if(!l.equals(m))return!1}return!0}function p(a,b,c){b=b||0,c=c||a.length-1;var d=[];return o(a,b,c)?(d.push(b),c!==a.length-1?d=d.concat(p(a,c,a.length-1)):c===a.length-1&&(d.length!==1||!h(a,0).equals(h(a,c)))&&d.push(c)):d=d.concat(p(a,b,c-1)),d}function q(a){try{var c=l(a),d=m(a,c),e=p(d),f=e.map(function(a){var c=b(a/(d.length-1),2);return{idx:c,color:h(d,a)}});return new g(f,c,a)}catch(i){return!1}}function r(a){var b=a.getImageData(0,0,a.canvas.width,a.canvas.height),c=b.width,d=b.height,e=b.data,f=[];for(var g=0;g<d;g++){var h=[];for(var i=0;i<c;i++){var j=(c*g+i)*4,k=e[j],l=e[j+1],m=e[j+2],n=e[j+3];h.push([k,l,m,n])}f[g]=h}return f}function s(a){var b=a.getContext("2d"),c=r(b),d=q(c);return d}function t(a,b){var c=new Image;c.src=a,c.onload=function(){var a=this,c=document.createElement("canvas"),d=c.getContext("2d");c.width=a.width,c.height=a.height,d.drawImage(a,0,0),b(s(c))}}function u(a,b){var c=a,d=b;return a.length&&(c=new f(a)),b.length&&(d=new f(b)),f.prototype.equals.apply(c,[d])}var f=function(a){typeof a=="string"&&(a=a.split(",")),this.r=a[0],this.g=a[1],this.b=a[2],this.a=a.length===4?a[3]:255;if(typeof this.r=="undefined"||typeof this.g=="undefined"||typeof this.b=="undefined")throw"Invalid Color Array passed in"};f.getAvg=function(a,b){var c=[(a.r+b.r)/2,(a.g+b.g)/2,(a.b+b.b)/2];if(typeof a.a!="undefined"||typeof (b.a!=="undefined"))a.a=typeof a.a=="undefined"?255:a.a,b.a=typeof b.a=="undefined"?255:b.a,c.push((a.a+b.a)/2);return new f(c)},f.prototype.equals=function(a,b){b=typeof b=="undefined"?20:b;if(Math.abs(this.r-a.r)>b)return!1;if(Math.abs(this.g-a.g)>b)return!1;if(Math.abs(this.b-a.b)>b)return!1;var c=typeof this.a=="undefined"?255:this.a,d=typeof a.a=="undefined"?255:a.a;return Math.abs(c-d)>b?!1:!0},f.prototype.toString=function(){return this.a===255?"rgb("+b(this.r)+", "+b(this.g)+", "+b(this.b)+")":"rgba("+b(this.r)+", "+b(this.g)+", "+b(this.b)+", "+b(this.a/255,2)+")"},g.prototype.toCanvas=function(){var a=document.createElement("canvas");a.width=this.colorarray[0].length,a.height=this.colorarray.length;var b=a.getContext("2d"),c=b.createImageData(a.width,a.height),f=d(this.colorarray);return e(f,c.data),b.clearRect(0,0,a.width,a.height),b.putImageData(c,0,0),a},g.prototype.toCss=function(){if(this.stops.length===1)return"background-color: "+this.stops[0].color.toString();var a=c(this.stops,function(a){return b(a.idx*100)});a=a.map(function(a){return a.color.toString()+" "+b(a.idx*100)+"%"});var d=this.angle+"deg, "+a.join(",");return"background: -webkit-linear-gradient("+d+");\n"+"background: -o-linear-gradient("+d+");\n"+"background: -ms-linear-gradient("+d+");\n"+"background: -moz-linear-gradient("+d+");\n"+"background: linear-gradient("+d+");\n"},a.GradientFinder={fromUrl:t,fromCanvas:s,colorsEqual:u,Gradient:g,Color:f}})(window);