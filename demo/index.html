<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript">
            // http://paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/
            window.log=function(){log.history=log.history||[];log.history.push(arguments);if(this.console){console.log(Array.prototype.slice.call(arguments))}};
        </script>
        <script type="text/javascript" src="jquery-1.7.2.min.js"></script>
        <script type="text/javascript" src="filereader.js"></script>
        <script type="text/javascript" src="../imgtocss.js"></script>
        <link rel="stylesheet" href="style.css" type="text/css">
        <script type="text/javascript">
            $(function() {
                var loadGrad = function(css) {
                    $("#grad").val(css);
                    $("#filedropper").attr("style", css);
                };
            
                var opts = {
                    readAsMap: {
                        '.*': 'DataURL'
                    },
                    dragClass: "filedrop",
                    on: {
                        error: function() {
                            alert("You must run this on a webserver to get results");
                        },
                        load: function (e, file) {
                            var data = e.target.result;
                            GradientCalc.findGrad(data, function(grad) {
                                loadGrad(grad.toCss());
                            });
                        }
                    }
                };
                
                $("#filedropper").fileReaderJS(opts).fileClipboard(opts);
                
                $("#startdemo").load(function(e) {
                    var img = this;
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    loadGrad(GradientCalc.findGradFromCanvas(canvas).toCss());
                });
            });
        </script>
        <style>
            #filedropper { width: 300px; height: 300px; border: 1px solid black; }
            .filedrop { background-color: red; }
            textarea { width: 800px; height: 200px; }
        </style>
    </head>
    
    <body>

    <div id="filedropper">
        Drop an image here to find it's gradient
    </div>
    <textarea id="grad">
    
    </textarea>
    
    <img id="startdemo" src="linear_rainbow.png" style="display:none" />    
    </body>