<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript">
            // http://paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/
            window.log=function(){log.history=log.history||[];log.history.push(arguments);if(this.console){console.log(Array.prototype.slice.call(arguments))}};
        </script>
        <script type="text/javascript" src="jquery-1.7.2.min.js"></script>
        <script type="text/javascript" src="filereader.js"></script>
        <script type="text/javascript" src="tinycolor.js"></script>
        <script type="text/javascript" src="imgtocss.js"></script>
        
        <script type="text/javascript" src="qunit.js"></script>
        
        
        <link rel="stylesheet" href="style.css" type="text/css">
        <link rel="stylesheet" href="qunit.css" type="text/css">
<script type="text/javascript">

    var gradTests = {
        singleStop: {
            start: "top",
            param: [0, 0, 0, 1],
            stops: {
                "0": "rgb(0, 0, 0)"
            }
        },
    
        singleVertical: {
            start: "top",
            param: [0, 0, 0, 1],
            stops: {
                "0": "rgb(0, 0, 0)",
                "1": "rgb(255, 255, 255)"
            }
        },        
        multiVertical: {
            start: "top",
            param: [0, 0, 0, 1],
            stops: {
                "0": "rgb(0, 0, 0)",
                "0.21717171717171718": "rgb(255, 0, 232)",
                "0.4696969696969697": "rgb(59, 42, 108)",
                "0.7474747474747475": "rgb(68, 0, 0)",
                "1": "rgb(255, 255, 255)"
            }
        },
        singleHorizontal: {
            start: "left",
            param: [0, 0, 1, 0],
            stops: {
                "0": "rgb(0, 0, 0)",
                "1": "rgb(255, 255, 255)"
            }               
        },
        singleColor: {
            start: "left",
            param: [0, 0, 1, 0],
            stops: {
                "0": "rgb(0, 255, 0)",
                "1": "rgb(255, 0, 0)"
            }               
        },               
        multiHorizontal: {
            start: "left",
            param: [1, 0, 0, 0 ],
            stops: {
                "0": "rgb(0, 0, 0)",
                "0.21717171717171718": "rgb(255, 0, 232)",
                "0.4696969696969697": "rgb(59, 42, 108)",
                "0.7474747474747475": "rgb(68, 0, 0)",
                "1": "rgb(255, 255, 255)"
            }
        },
        singleDiagLtr: {
            start: "top_left",
            param: [0, 0, 0, 1],
            stops: {
                "0": "rgb(0, 0, 0)",
                "1": "rgb(255, 255, 255)"
            }
        },
        multiDiagLtr: {
            start: "top_left",
            param: [1, 1, 0, 0],
            stops: {
                "0": "rgb(0, 0, 0)",
                "0.21717171717171718": "rgb(255, 0, 232)",
                "0.4696969696969697": "rgb(59, 42, 108)",
                "0.7474747474747475": "rgb(68, 0, 0)",
                "1": "rgb(255, 255, 255)"
            }
        },
        singleDiagRtl: {
            start: "top_right",
            param: [0, 0, 0, 1],
            stops: {
                "0": "rgb(0, 0, 0)",
                "1": "rgb(255, 255, 255)"
            }
        },
        multiDiagRtl: {
            start: "top_right",
            param: [0, 0, 0, 1],
            stops: {
                "0": "rgb(0, 0, 0)",
                "0.21717171717171718": "rgb(255, 0, 232)",
                "0.4696969696969697": "rgb(59, 42, 108)",
                "0.7474747474747475": "rgb(68, 0, 0)",
                "1": "rgb(255, 255, 255)"
            }        
        }
    };

    $(function() {
        QUnit.init();
        
        var key, canvas, context, grad, gradient, idx, calcgrad;        
        for (key in gradTests) {        
            if (gradTests.hasOwnProperty(key)) {
                var width = 300;
                var height = 300;
            
                grad = gradTests[key];
                canvas = document.createElement('canvas');
                context = canvas.getContext('2d')
                canvas.width = width;
                canvas.height = height;                 
                var param = [grad.param[0] * width, grad.param[1] * height, grad.param[2] * width, grad.param[3] * height];                
                gradient = context.createLinearGradient.apply(context, param);
                                                
                for (idx in grad.stops) {
                    if (grad.stops.hasOwnProperty(idx)) {
                        log(idx, grad.stops[idx]);
                        gradient.addColorStop(parseFloat(idx), grad.stops[idx]);
                    }
                }
                context.fillStyle = gradient;
                context.fillRect(0, 0, width, height);                                
                testGrad(key, grad, canvas);     
                $("body").append(canvas);
                
            }
        }
        
        function testGrad(name, grad, canvas) {
            var calcgrad = findGradFromCanvas(canvas);                                        
            test(name, function() {
                equal(calcgrad.start, grad.start);
                equal(calcgrad.stops.length, grad.stops.length);
                
                for (var idx in calcgrad.stops) {
                    if (calcgrad.stops.hasOwnProperty(idx)) {
                        equal(calcgrad.stops[idx].toRgbString(), grad.stops[idx], idx);
                    }
                }                                                
            });                        
        }
    });

    // 
    $(function() {
        var opts = {
            readAsMap: {
                '.*': 'DataURL'
            },
            dragClass: "filedrop",
            on: {
                load: function (e, file) {
                    var data = e.target.result;
                    findGrad(data);
                }
            }
        };
        $(".dropper").fileReaderJS(opts).fileClipboard(opts);
    });
</script>

</head>
    <body>
        <h1 id="qunit-header">QUnit example</h1>  
        <h2 id="qunit-banner"></h2>  
        <h2 id="qunit-userAgent"></h2>  
        <ol id="qunit-tests">          
    </body>
</html>


